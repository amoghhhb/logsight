<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Log Summarizer - LogSight (Coming Soon)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a192f;
            color: #c8d6e5;
            overflow-x: hidden;
            /* Prevent horizontal scroll */
        }

        /* tsParticles container for animated background */
        #tsparticles-ai {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            /* Sits behind content */
        }

        /* Mouse-following glow effect */
        #glow-orb {
            position: fixed;
            top: 0;
            left: 0;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0) 70%);
            border-radius: 50%;
            pointer-events: none;
            /* Don't let it block clicks */
            transition: transform 0.1s ease-out;
            z-index: 5;
            /* Above particles, below nav */
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a192f;
        }

        ::-webkit-scrollbar-thumb {
            background-color: #3b82f6;
            border-radius: 10px;
            border: 2px solid #0a192f;
        }

        /* Sticky nav background blur - UPDATED Z-INDEX */
        .sticky-nav {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            background-color: rgba(10, 25, 47, 0.85);
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            position: sticky;
            /* Z-index must be higher than the overlay (1000) */
            z-index: 1001; 
        }

        /* Ensure main content and footer sit above particles */
        main,
        footer {
            position: relative;
            z-index: 10;
        }


        /* Chat bubble styles */
        .chat-bubble {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 16px;
            word-wrap: break-word;
        }

        .chat-bubble.user {
            background-color: #3b82f6;
            color: white;
            border-bottom-right-radius: 4px;
            align-self: flex-end;
        }

        .chat-bubble.ai {
            background-color: #1e293b;
            /* slate-800 */
            color: #e2e8f0;
            /* slate-200 */
            border-bottom-left-radius: 4px;
            align-self: flex-start;
        }

        /* AI typing indicator */
        .typing-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #94a3b8;
            /* slate-400 */
            animation: bounce 1.4s infinite both;
        }

        .typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }

        @keyframes bounce {

            0%,
            80%,
            100% {
                transform: scale(0);
            }

            40% {
                transform: scale(1);
            }
        }

        /* File dropzone highlight */
        .dropzone-active {
            border-color: #facc15 !important;
            /* brand-yellow */
            background-color: rgba(250, 204, 21, 0.1);
        }

        /* Prevent text selection */
        body.select-none,
        body .select-none {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        /* Custom styles for the Coming Soon overlay - UPDATED POINTER-EVENTS */
        #coming-soon-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5); /* Slightly dark overlay */
            backdrop-filter: blur(8px); /* Blur the content underneath */
            -webkit-backdrop-filter: blur(8px);
            z-index: 1000; /* Ensure it's on top of most content */
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            /* Allow clicks to pass through the overlay (but not the text inside) */
            pointer-events: none; 
        }
        
        #coming-soon-text {
            /* Text style */
            color: #facc15; /* brand-yellow */
            font-size: 4rem;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(250, 204, 21, 0.8);
            /* This is the only part of the overlay that should block clicks */
            pointer-events: all; 
        }
    </style>
</head>

<body class="bg-brand-navy text-gray-300 select-none" style="background-color: #0a192f;">
    <div id="tsparticles-ai"></div>

    <div id="glow-orb"></div>

    <div id="coming-soon-overlay">
        <h1 id="coming-soon-text">Coming Soon...</h1>
    </div>

    <header id="main-header"
        class="sticky top-0 left-0 right-0 transition-all duration-300 py-4 select-none sticky-nav">
        <nav class="container mx-auto px-6 flex justify-between items-center">
            <a href="/" class="flex items-center gap-2 group">
                <img src="LogSight.png" alt="LogSight Logo"
                    class="w-10 h-10 rounded-full transition-all duration-300 group-hover:scale-110">
                <span class="text-white text-xl font-bold group-hover:text-brand-yellow transition-colors">LogSight</span>
            </a>

            <a href="/"
                class="bg-brand-yellow text-brand-navy font-bold py-2 px-5 rounded-lg shadow-lg hover:bg-yellow-300">
                Home Page
            </a>
        </nav>
    </header>

    <main>
        <section id="ai-summarizer" class="py-24 relative z-10">
            <div class="container mx-auto px-6 max-w-4xl">
                <h2 class="text-4xl font-extrabold text-white text-center mb-6">
                    Try the <span class="text-brand-yellow">AI-Powered</span> Log Summarizer
                </h2>
                <p class="text-lg text-gray-400 text-center mb-12">
                    Upload a log file (.log, .txt) or an analysis report to get an instant summary and ask
                    questions.
                </p>

                <div class="bg-gray-900 bg-opacity-70 border border-gray-700 rounded-xl shadow-2xl p-6">
                    <div id="upload-section">
                        <label for="file-upload" id="dropzone"
                            class="relative block w-full border-2 border-dashed border-gray-600 rounded-lg p-12 text-center cursor-pointer hover:border-gray-500 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="mx-auto h-12 w-12 text-gray-500">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m.75 12l3 3m0 0l3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                            </svg>
                            <span id="dropzone-text" class="mt-2 block text-sm font-semibold text-gray-300">
                                Drag & drop a file here, or click to upload
                            </span>
                            <span class="mt-1 block text-xs text-gray-500">Max file size: 2MB</span>
                            <input id="file-upload" name="file-upload" type="file" class="sr-only"
                                accept=".log,.txt,.html,.enc">
                        </label>
                        <button id="summarize-button" disabled
                            class="w-full mt-6 py-3 px-6 rounded-lg font-bold text-lg transition-all duration-300 bg-brand-yellow text-brand-navy opacity-50 cursor-not-allowed">
                            Summarize File
                        </button>
                    </div>

                    <div id="chat-section" class="hidden">
                        <div id="chat-log"
                            class="h-96 overflow-y-auto p-4 flex flex-col space-y-4 border border-gray-700 rounded-lg mb-4">
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="text" id="chat-input"
                                class="flex-1 px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-brand-blue focus:border-transparent"
                                placeholder="Ask a follow-up question...">
                            <button id="send-button"
                                class="py-3 px-5 rounded-lg bg-brand-blue text-white font-semibold hover:bg-blue-600 transition-colors">
                                Send
                            </button>
                        </div>
                        <button id="reset-button"
                            class="w-full mt-4 py-2 px-4 rounded-lg font-medium text-sm text-gray-400 hover:bg-gray-800 hover:text-gray-200 transition-colors">
                            Start Over with a New File
                        </button>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <footer class="py-16 bg-brand-navy border-t border-gray-800 relative z-10">
        <div class="container mx-auto px-6">
            <div class="flex flex-col md:flex-row justify-between items-center text-center md:text-left">
                <div class="mb-8 md:mb-0">
                    <a href="/" class="flex items-center justify-center md:justify-start gap-2 mb-4">
                        <img src="LogSight.png" alt="LogSight Logo" class="w-10 h-10 rounded-full">
                        <span class="text-white text-xl font-bold">LogSight</span>
                    </a>
                    <p class="text-gray-500">&copy; 2024 LogSight. All rights reserved.</p>
                    <p class="text-gray-500 text-sm mt-1">Created by Samyak Wadwinde & Amogh Bandre</p>
                </div>

                <div class="flex flex-col md:flex-row gap-8 md:gap-12">
                    <div>
                        <h5 class="font-semibold text-gray-300 mb-3">Navigate</h5>
                        <ul class="space-y-2">
                            <li><a href="/"
                                    class="text-gray-400 hover:text-brand-yellow transition-colors">Main Site</a></li>
                            <li><a href="/#about"
                                    class="text-gray-400 hover:text-brand-yellow transition-colors">About Us</a></li>
                            <li><a href="/#contact"
                                    class="text-gray-400 hover:text-brand-yellow transition-colors">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h5 class="font-semibold text-gray-300 mb-3">Legal</h5>
                        <ul class="space-y-2">
                            <li><a href="#" class="text-gray-400 hover:text-brand-yellow transition-colors">Privacy
                                        Policy</a></li>
                            <li><a href="#" class="text-gray-400 hover:text-brand-yellow transition-colors">Terms of
                                        Service</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <script>
        // Set Tailwind config
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'brand-navy': '#0a192f', // Dark background
                        'brand-blue': '#3b82f6', // Accent blue
                        'brand-yellow': '#facc15', // Accent yellow
                    },
                }
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const glowOrb = document.getElementById('glow-orb');

            // --- Mouse-following glow ---
            document.addEventListener('mousemove', (e) => {
                if (glowOrb) {
                    // Using translate3d for hardware acceleration
                    glowOrb.style.transform = `translate3d(${e.clientX}px, ${e.clientY}px, 0) translate(-50%, -50%)`;
                }
            });

            // --- tsParticles Initialization (Star Field for AI Page) ---
            (async () => {
                try {
                    await tsParticles.load({
                        id: "tsparticles-ai", // Unique ID
                        options: {
                            background: {
                                color: {
                                    value: "#0a192f"
                                }
                            },
                            fpsLimit: 60,
                            interactivity: {
                                events: {
                                    onHover: {
                                        enable: true,
                                        mode: "repulse" // Move away from mouse
                                    }
                                },
                                modes: {
                                    repulse: {
                                        distance: 100, // Area of effect
                                        duration: 0.4
                                    }
                                }
                            },
                            particles: {
                                color: {
                                    value: "#ffffff" // White stars
                                },
                                links: { // Disable links
                                    enable: false
                                },
                                move: {
                                    direction: "top", // Move upwards
                                    enable: true,
                                    outModes: {
                                        default: "out" // Leave screen at top
                                    }
                                },
                                number: {
                                    density: {
                                        enable: true,
                                        area: 800
                                    },
                                    value: 150 // More stars
                                },
                                opacity: {
                                    value: { min: 0.3, max: 0.8 }, // Twinkling effect
                                    animation: {
                                        enable: true,
                                        speed: 1,
                                        sync: false
                                    }
                                },
                                shape: {
                                    type: "circle"
                                },
                                size: {
                                    value: { min: 0.5, max: 2 } // Small stars
                                }
                            },
                            detectRetina: true
                        }
                    });
                } catch (error) {
                    console.error("Error loading tsParticles:", error);
                }
            })();


            // --- AI Summarizer Logic Variables ---
            const uploadSection = document.getElementById('upload-section');
            const chatSection = document.getElementById('chat-section');
            const summarizeButton = document.getElementById('summarize-button');
            const resetButton = document.getElementById('reset-button');
            const fileUpload = document.getElementById('file-upload');
            const dropzone = document.getElementById('dropzone');
            const dropzoneText = document.getElementById('dropzone-text');

            const chatLog = document.getElementById('chat-log');
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('send-button');

            const MAX_FILE_SIZE = 2 * 1024 * 1024; // 2MB
            let fileContent = ""; // Store the uploaded file content

            // --- File Handling ---
            if (fileUpload) {
                fileUpload.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    handleFile(file);
                });
            }
            if (dropzone) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    dropzone.addEventListener(eventName, () => dropzone.classList.add('dropzone-active'), false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    dropzone.addEventListener(eventName, () => dropzone.classList.remove('dropzone-active'), false);
                });

                dropzone.addEventListener('drop', (e) => {
                    const file = e.dataTransfer.files[0];
                    handleFile(file);
                }, false);
            }


            function handleFile(file) {
                if (!file) {
                    fileContent = "";
                    updateSummarizeButton(null);
                    return;
                }

                if (file.size > MAX_FILE_SIZE) {
                    alert('File is too large. Max size is 2MB.');
                    fileContent = "";
                    updateSummarizeButton(null);
                    return;
                }

                const reader = new FileReader();
                reader.onload = (e) => {
                    fileContent = e.target.result;
                    updateSummarizeButton(file);
                };
                reader.onerror = () => {
                    alert('Error reading file.');
                    fileContent = "";
                    updateSummarizeButton(null);
                };
                reader.readAsText(file);
            }

            function updateSummarizeButton(file) {
                if (file && fileContent) {
                    dropzoneText.textContent = `File selected: ${file.name}`;
                    dropzone.classList.add('border-green-500');
                    summarizeButton.disabled = false;
                    summarizeButton.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    dropzoneText.textContent = 'Drag & drop a file here, or click to upload';
                    dropzone.classList.remove('border-green-500');
                    summarizeButton.disabled = true;
                    summarizeButton.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            // --- Chat Logic ---
            if (summarizeButton) {
                summarizeButton.addEventListener('click', startSummary);
                sendButton.addEventListener('click', handleUserMessage);
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        handleUserMessage();
                    }
                });
                resetButton.addEventListener('click', resetApp);
            }

            async function startSummary() {
                if (!fileContent) return;

                uploadSection.classList.add('hidden');
                chatSection.classList.remove('hidden');

                addMessageToLog('Analyzing your file...', 'ai', true); // Show typing indicator

                // This is the prompt for the *initial summary*
                const systemPrompt = "You are a log file analysis expert. A user has uploaded a file. Provide a concise, bullet-pointed summary of the file's content. Focus on critical errors, warnings, key events, and overall activity. If it's not a log file, just summarize its content.";
                const userQuery = `Here is the file content:\n\n${fileContent}\n\nPlease summarize it.`;

                // *** SECURE SERVERLESS CALL ***
                const aiResponse = await callServerlessAPI(systemPrompt, userQuery);
                updateLastAiMessage(aiResponse); // Update the "Analyzing..." message
            }

            function handleUserMessage() {
                const userQuery = chatInput.value.trim();
                if (!userQuery) return;

                addMessageToLog(userQuery, 'user');
                chatInput.value = '';

                addMessageToLog('Thinking...', 'ai', true); // Show typing indicator

                // This is the prompt for *follow-up questions*
                const systemPrompt = `You are a log file analysis expert. The user has already provided a file with the following content:\n\n${fileContent}\n\nYou have already provided an initial summary. Now, answer the user's follow-up questions based *only* on the file content provided.`;

                // *** SECURE SERVERLESS CALL ***
                callServerlessAPI(systemPrompt, userQuery).then(aiResponse => {
                    updateLastAiMessage(aiResponse);
                });
            }

            function addMessageToLog(message, sender, isTyping = false) {
                const bubble = document.createElement('div');
                bubble.classList.add('chat-bubble', sender);

                if (isTyping) {
                    bubble.id = 'typing-indicator';
                    bubble.innerHTML = `
                        <div class="typing-indicator">
                            <span></span><span></span><span></span>
                        </div>
                    `;
                } else {
                    // Simple text formatting for newlines
                    bubble.textContent = message;
                    bubble.style.whiteSpace = 'pre-wrap';
                }

                chatLog.appendChild(bubble);
                chatLog.scrollTop = chatLog.scrollHeight;
            }

            function updateLastAiMessage(newMessage) {
                const typingIndicator = document.getElementById('typing-indicator');
                if (typingIndicator) {
                    // Simple text formatting for newlines
                    typingIndicator.textContent = newMessage;
                    typingIndicator.style.whiteSpace = 'pre-wrap';
                    typingIndicator.id = ''; // Remove ID so it's not selected again
                }
                chatLog.scrollTop = chatLog.scrollHeight;
            }

            function resetApp() {
                fileContent = "";
                fileUpload.value = ''; // Reset file input
                updateSummarizeButton(null);
                chatLog.innerHTML = '';
                chatSection.classList.add('hidden');
                uploadSection.classList.remove('hidden');
            }

            // 🚀 --- SECURE SERVERLESS API CALL FUNCTION (CALLS VERCEL) --- 🚀
            // This function securely calls your Vercel serverless endpoint at /api/summarize
            async function callServerlessAPI(systemPrompt, userQuery) {

                // The URL now points to your Vercel serverless function
                const apiUrl = "/api/summarize";

                // The payload sends the prompts to the serverless function
                const payload = {
                    systemPrompt: systemPrompt,
                    userQuery: userQuery
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            // Ensure the Vercel function receives JSON data
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(payload)
                    });

                    // Handle non-OK status codes
                    if (!response.ok) {
                        const errorText = await response.text();
                        console.error("Serverless Function Error:", errorText);
                        // Return a user-friendly error to the chat log
                        return `Error: AI Request Failed. Status: ${response.status}. Message: ${errorText}`;
                    }

                    // The Vercel function sends back only the final text content
                    const aiResponseText = await response.text();
                    return aiResponseText;

                } catch (error) {
                    console.error("Network Error or Server Unreachable:", error);
                    return "Error: Could not communicate with the serverless function.";
                }
            }

            // --- 🔒 Developer Tool Redirection Logic (Added) 🔒 ---
            const mainPageUrl = "/"; // The URL to redirect to

            // Function to check for active dev tools and redirect
            function checkDevTools() {
                // Check a common indicator: the size of the window and the console
                const widthThreshold = window.outerWidth - window.innerWidth > 160;
                const heightThreshold = window.outerHeight - window.innerHeight > 160;

                // A highly common heuristic for most modern browsers
                if (widthThreshold || heightThreshold) {
                    // Check if the current page is NOT the main page to avoid redirect loop
                    if (window.location.pathname !== mainPageUrl) {
                        window.location.href = mainPageUrl;
                    }
                }
            }

            // Continuous checks to catch developer tool opening
            setInterval(checkDevTools, 500);

            // Event listener for key presses (F12)
            document.addEventListener('keydown', (e) => {
                // F12 key check
                if (e.key === 'F12' || e.keyCode === 123) {
                    e.preventDefault();
                    if (window.location.pathname !== mainPageUrl) {
                        window.location.href = mainPageUrl;
                    }
                }
            });

            // Disable context menu (right-click)
            document.addEventListener('contextmenu', (e) => {
                e.preventDefault();
            });
            // --- 🔒 END Developer Tool Redirection Logic 🔒 ---
        });
    </script>
</body>

</html>
